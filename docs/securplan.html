<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Test notifiche push</title>
</head>
<body>
	<h1>Test notifiche push</h1>

	nome:

	<input id="key_to_user" style="width: 99%">
	key|to
	<input id="key_to" type="password" style="width: 99%">

	<p>
	data: <select id="and_iph">
		<option value="android">android</option>
		<option value="iphone">iphone</option>
	</select>
	<textarea style="width: 99%; height: 12em"></textarea>
	<p>
	<button id="invia">invia</button>

	<script>
	
		const  android_data = {
		"to": "",
		"data": {
		      "critical": 1,
		      "title": "title",
		      "subtitle": "subtitle",
		      "messageID": 1,
		      "messageToken": 1,
		      "timestamp": 1692356676,
		      "source": "Firebase"
		   },
		"priority":"high"
		}
	
		const  iphone_data = {
				"to": "",
				   "data": {
				      "critical": 1,
					"title":"title",
					"subtitle":"subtitle",
					"messageID":1,
					"messageToken":1,
					"timestamp": 1692356676,
					"source":"Firebase"
				   },
				 "notification":{
				    "title":"Sparky says hello!",
				    "mutable_content":"true"
				    }
			}

		const t = document.querySelector('textarea');
		
		// t.value = JSON.stringify(init_data, null, 3)
		
		const b = document.querySelector('#invia');
		
		const key_to = document.querySelector('#key_to');
		
		// console.log(b)
		b.onclick = async () => {
			console.log(t.value)
			// console.log('prima')
			const data = JSON.parse(t.value)
			// console.log('dopo')
			// alert(data.to)
			
			
			const key_to_arr = key_to.value.split('\|')
			
			data.to = key_to_arr[1]
			const auth = "key=" + key_to_arr[0]
			
			const response = await fetch('https://fcm.googleapis.com/fcm/send', {
				method: "POST",
				headers: {
					"Content-Type": "application/json",
					"Authorization": auth
					},
					body: JSON.stringify(data)
			});
			alert(JSON.stringify(await response.json()));
		};
		
		const select = document.getElementById('and_iph');
		
		select.onchange = () => {
			t.value = JSON.stringify(select.value == 'android' ? android_data : iphone_data, null, 3);
		}
		
		select.onchange();
		
	</script>
</body>
</html>
